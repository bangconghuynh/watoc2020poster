% BCHNottingham theme based on Gemini theme
% https://github.com/anishathalye/gemini

% ============
% Dependencies
% ============

\RequirePackage{exscale}
\RequirePackage{ragged2e}
\RequirePackage{changepage}
\RequirePackage{fontspec}

% =====
% Fonts
% =====

\newfontfamily\Raleway{Raleway}[%
  UprightFont=*-Regular,%
  ItalicFont=*-Italic,%
  BoldFont=*-Bold,%
  BoldItalicFont=*-BoldItalic,%
  Ligatures=TeX,%
]
\newfontfamily\Lato{Lato}[%
  Ligatures=TeX,%
]

\usefonttheme{professionalfonts}

\setmainfont{Lato}[%
  UprightFont=*-Regular,%
  ItalicFont=*-Italic,%
  BoldFont=*-Bold,%
  BoldItalicFont=*-BoldItalic,%
  Ligatures=TeX,%
]
\setsansfont{Lato}[%
  UprightFont=*-Regular,%
  ItalicFont=*-Italic,%
  BoldFont=*-Bold,%
  BoldItalicFont=*-BoldItalic,%
  Ligatures=TeX,%
]

\setbeamerfont{headline}{family=\Raleway}
\setbeamerfont{headline title}{size=\huge, series=\bfseries}
\setbeamerfont{headline author}{size=\Large}
\setbeamerfont{headline institute}{size=\normalsize}
\setbeamerfont{footline}{family=\Raleway}
\setbeamerfont{footline address}{size=\normalsize}
\setbeamerfont{block title}{family=\Raleway, size=\LARGE, series=\bfseries}
\setbeamerfont{block body}{size=\large}
\setbeamerfont{heading}{family=\Lato, series=\bfseries}
\setbeamerfont{caption}{size=\small}

% ====================
% Maths
% ====================
\usepackage[%
  math-style=ISO,%
  bold-style=ISO,%
  warnings-off={mathtools-colon},%
]{unicode-math}

% Main maths font
\setmathfont{Fira Math}

% Missing glyph ranges
\setmathfont{STIX Two Math}[%
  range={scr, bfscr, cal, bfcal},%
]


% ==================
% Special characters
% ==================
\usepackage[fixed]{fontawesome5}

% ====================
% Macros
% ====================

\newcommand{\samelineand}{\qquad}
\makeatletter
  \def\beamer@andtitle{\unskip, } % replaces \and between author names (original definition is \quad)
  \def\beamer@andinst{\quad} % replaces \and between institutions (original definition is \\[1em])
\makeatother

\newcommand*{\emphbold}[2]{%
  \textbf{\color{#1}#2}%
}

% ====================
% Elements
% ====================
% Line spacing
\linespread{1.05}

% List
\setlength{\leftmarginii}{1.5cm}
\makeatletter
\def\@listi{\leftmargin\leftmarginii
\topsep 1ex % spacing before
\parsep 0\p@ \@plus\p@
\itemsep 0.5ex} % spacing between
\makeatother

% Itemize
\setbeamertemplate{itemize item}{\footnotesize\faCanadianMapleLeaf}
\setbeamertemplate{itemize subitem}{\raise0.3ex \hbox{\vrule width 0.5ex height 0.5ex}}
\setbeamertemplate{itemize subsubitem}{\raise0.2ex \hbox{\vrule width 0.5ex height 0.5ex}}

% Justify itemize
\makeatletter
\renewcommand{\itemize}[1][]{%
  \beamer@ifempty{#1}{}{\def\beamer@defaultospec{#1}}%
  \ifnum \@itemdepth >2\relax\@toodeep\else
    \advance\@itemdepth\@ne
    \beamer@computepref\@itemdepth% sets \beameritemnestingprefix
    \usebeamerfont{itemize/enumerate \beameritemnestingprefix body}%
    \usebeamercolor[fg]{itemize/enumerate \beameritemnestingprefix body}%
    \usebeamertemplate{itemize/enumerate \beameritemnestingprefix body begin}%
    \list
      {\usebeamertemplate{itemize \beameritemnestingprefix item}}
      {\def\makelabel##1{%
          {%
            \hss\llap{{%
                \usebeamerfont*{itemize \beameritemnestingprefix item}%
                \usebeamercolor[fg]{itemize \beameritemnestingprefix item}##1}}%
          }%
        }%
      }
  \fi%
  \beamer@cramped%
  \justifying % NEW
  %\raggedright % ORIGINAL
  \beamer@firstlineitemizeunskip%
}
\makeatother

% Enumerate
\setbeamertemplate{enumerate item}{\insertenumlabel.}
\setbeamertemplate{enumerate subitem}{\insertsubenumlabel.}
\setbeamertemplate{enumerate subsubitem}{\insertsubsubenumlabel.}

% Equation
\setlength\abovedisplayskip{1.4ex}
\setlength\belowdisplayskip{1.7ex}

% Caption
\setbeamerfont{caption name}{series=\bfseries}
\setbeamertemplate{caption}[numbered]
\setbeamertemplate{caption label separator}[period]
\setlength{\abovecaptionskip}{2ex}
\setlength{\belowcaptionskip}{1ex}

% Bibliography
\setbeamertemplate{bibliography item}[text]

% Navigation
\beamertemplatenavigationsymbolsempty

% ====================
% Components
% ====================

% Heading
\newcommand\heading[1]
{%
    \par\bigskip
    {\usebeamerfont{heading}\usebeamercolor[fg]{heading}#1}\par\smallskip
}

% Headline
\setbeamertemplate{headline}
{
    \begin{beamercolorbox}{headline}
        \begin{columns}
          \begin{column}{0.0275\paperwidth}
          \end{column}
          \begin{column}{0.095\paperwidth}
            \begin{center}
              \vskip4ex
              \includegraphics[width=.9\linewidth]{images/qr.png}
            \end{center}
          \end{column}
          \begin{column}{0.655\paperwidth}
              \usebeamerfont{headline}
              \vskip1ex
              \centering
              {\usebeamerfont{headline title}\usebeamercolor[fg]{headline title}\inserttitle\\[0.5ex]}
              {\usebeamerfont{headline author}\usebeamercolor[fg]{headline author}\insertauthor\\[1ex]}
              {\usebeamerfont{headline institute}\usebeamercolor[fg]{headline institute}\insertinstitute\\[1ex]}
          \end{column}
          \begin{column}{0.195\paperwidth}
            \begin{center}
              \vskip4ex
              \includegraphics[width=.90\linewidth]{images/UoN2}
              \vskip4ex
              \includegraphics[width=.90\linewidth]{images/quest}
            \end{center}
          \end{column}
          \begin{column}{0.0275\paperwidth}
          \end{column}
        \end{columns}
        \vspace{3ex}
        \ifbeamercolorempty[bg]{headline rule}{}{
            \begin{beamercolorbox}[wd=\paperwidth,colsep=0.5ex]{headline rule}
            \end{beamercolorbox}
        }
    \end{beamercolorbox}
}

% Block
\setbeamertemplate{block begin}
{
    \begin{beamercolorbox}[colsep*=0ex, dp=2ex, center]{block title}
        \vskip-0.35ex
        \usebeamerfont{block title}\insertblocktitle
        \vskip-1.75ex
        \begin{beamercolorbox}[colsep=0.025ex]{block separator}\end{beamercolorbox}
    \end{beamercolorbox}
    {\parskip0pt\par}
    \usebeamerfont{block body}
    \vskip-0.1ex
    \begin{beamercolorbox}[colsep*=0ex]{block body}
    \justifying
    \begin{adjustwidth}{.5ex}{.5ex}
    \setlength{\parskip}{1ex}
    \vskip-2.5ex
}
\setbeamertemplate{block end}
{
    \end{adjustwidth}
    \vskip.5ex
    \end{beamercolorbox}
    \vskip0pt
    \vspace*{0.75ex}
}

% Alert Block
\setbeamertemplate{block alerted begin}
{
    \begin{beamercolorbox}[colsep*=0ex, dp=2ex, center]{block alerted title}
        \vskip-0.35ex
        \usebeamerfont{block title}\insertblocktitle
        \vskip-1.75ex
        \begin{beamercolorbox}[colsep=0.025ex]{block alerted separator}\end{beamercolorbox}
    \end{beamercolorbox}
    {\parskip0pt\par}
    \usebeamerfont{block body}
    \vskip-0.1ex
    \begin{beamercolorbox}[colsep*=0ex]{block alerted body}
    \justifying
    \begin{adjustwidth}{0.5ex}{0.5ex}
    \setlength{\parskip}{1ex}
    \vskip-2.5ex
}
\setbeamertemplate{block alerted end}
{
    \end{adjustwidth}
    \vskip0.5ex
    \end{beamercolorbox}
    \vskip0pt
    \vspace*{0.75ex}
}

%Footline
\setbeamertemplate{footline}
{
  \begin{beamercolorbox}[wd=\paperwidth, colsep=0.5ex]{footline rule}
%    \rule{0pt}{2pt}
  \end{beamercolorbox}
  \leavevmode%
  \begin{beamercolorbox}[leftskip=1cm, rightskip=1cm]{footline}
    \vskip1ex
    {\usebeamerfont{footline address} \href{https://quest.codes}{https://quest.codes}}
    \hfill
    {\usebeamerfont{footline address}\href{mailto:bang.huynh@nottingham.ac.uk}{bang.huynh@nottingham.ac.uk}}
    \vskip1ex
  \end{beamercolorbox}
}
